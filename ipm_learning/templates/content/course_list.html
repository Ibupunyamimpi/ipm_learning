{% extends "base.html" %}

{% block content %}
<section class="text-gray-600 body-font" x-data="courseSearch()">

  <div class="px-4">
    <div class="flex flex-col text-start w-full mt-7 mb-5">
        <h1 class="sm:text-4xl text-3xl font-medium title-font mb-2 text-gray-900">Acara dan Kursus</h1>
    </div>
    <div class="h-1 bg-gray-200 rounded mb-7 mx-auto">
        <div class="w-24 h-full bg-red-500"></div>
    </div>
  </div>

  <!-- Collapsible Filter Menu for Mobile -->
  <div class="lg:hidden px-4 py-4">
    <button @click="showFilters = !showFilters" class="w-full text-left bg-gray-200 p-2 rounded">Search & Filter</button>
    <div x-show="showFilters" class="mt-4">
        <!-- Your filter form for mobile goes here -->
        <form hx-get="{% url 'content:course-list' %}" hx-target="#course-list" hx-swap="innerHTML" id="course-search-form">
          <!-- Search input -->
          <div class="mb-4">
            <!-- {% if search_query %} -->
            <!-- <p class="mb-2 text-gray-700">"{{ search_query }}"</p> -->
            <!-- {% endif %} -->
            <input type="text" name="search" placeholder="Mencari" x-model="searchQuery" @input="debounce(submitForm, 300)" class="w-full px-4 py-2 border rounded">
          </div>
          
          <!-- Course Type Filter -->
          <div class="mb-4">
            <h4 class="mb-2 font-medium">Jenis Kursus:</h4>
            {% for type, display_name in type_choices %}
            <label>
                <input type="checkbox" name="course_type" value="{{ type }}" checked class="mr-2"> {{ display_name }}
            </label><br>
            {% endfor %}
          </div>

          <!-- Category Filter -->
          <div class="mb-4">
              <h4 class="mb-2 font-medium">Kategori:</h4>
              {% for category in categories %}
                  <label><input type="checkbox" name="category" value="{{ category.id }}" checked class="mr-2"> {{ category.name }}</label><br>
              {% endfor %}
          </div>

          <!-- Price Filter -->
          <div class="mb-4">
              <h4 class="mb-2 font-medium">Harga:</h4>
              <label><input type="checkbox" name="price" value="free" checked class="mr-2"> Gratis</label><br>
              <label><input type="checkbox" name="price" value="paid" checked class="mr-2"> Berbayar</label>
          </div>

          <!-- Search and Clear buttons -->
          <div class="mt-6">
              <button type="submit" class="mr-2 py-2 px-4 text-white bg-red-400 rounded hover:bg-red-300">Mencari</button>
              <button type="button" @click="clearSearchAndRefresh()" class="py-2 px-4 bg-gray-200 rounded hover:bg-gray-300">Jernih</button>
          </div>
      </form>
    </div>
</div>

  <!-- Flex layout for sidebar and main content -->
  <div class="flex">

    

    <!-- Filter Form for Desktop -->
    <section class="hidden lg:block relative py-4">
        <div class="container px-4 mx-auto">
            <div class="max-w-md mx-auto py-6 lg:py-12 px-4 lg:px-8 bg-white border rounded-xl">
                <form hx-get="{% url 'content:course-list' %}" hx-target="#course-list" hx-swap="innerHTML" id="course-search-form">
                    <!-- Search input -->
                    <div class="mb-4">
                      <!-- {% if search_query %} -->
                      <!-- <p class="mb-2 text-gray-700">"{{ search_query }}"</p> -->
                      <!-- {% endif %} -->
                      <input type="text" name="search" placeholder="Mencari" x-model="searchQuery" @input="debounce(submitForm, 300)" class="w-full px-4 py-2 border rounded">
                    </div>
                    
                    <!-- Course Type Filter -->
                    <div class="mb-4">
                      <h4 class="mb-2 font-medium">Jenis Kursus:</h4>
                      {% for type, display_name in type_choices %}
                      <label>
                          <input type="checkbox" name="course_type" value="{{ type }}" checked class="mr-2"> {{ display_name }}
                      </label><br>
                      {% endfor %}
                    </div>

                    <!-- Category Filter -->
                    <div class="mb-4">
                        <h4 class="mb-2 font-medium">Kategori:</h4>
                        {% for category in categories %}
                            <label><input type="checkbox" name="category" value="{{ category.id }}" checked class="mr-2"> {{ category.name }}</label><br>
                        {% endfor %}
                    </div>

                    <!-- Price Filter -->
                    <div class="mb-4">
                        <h4 class="mb-2 font-medium">Harga:</h4>
                        <label><input type="checkbox" name="price" value="free" checked class="mr-2"> Gratis</label><br>
                        <label><input type="checkbox" name="price" value="paid" checked class="mr-2"> Berbayar</label>
                    </div>

                    <!-- Search and Clear buttons -->
                    <div class="mt-6 flex space-x-2">
                      <button type="submit" class="flex-1 mr-2 py-2 px-4 text-white bg-red-400 rounded hover:bg-red-300">Mencari</button>
                      <button type="button" @click="clearSearchAndRefresh()" class="flex-1 py-2 px-4 bg-gray-200 rounded hover:bg-gray-300">Jernih</button>
                    </div>
                </form>
                
            </div>
        </div>
    </section>

    <!-- Main content for displaying courses -->
    <div class="w-full lg:w-3/4 p-4" id="course-list">
        {% include "content/course_list_partial.html" %}
  </div>

</section>

<script src="https://unpkg.com/htmx.org@1.6.1"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>

<script>
  function debounce(callback, wait) {
    let timeoutId = null;
    return (...args) => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            callback.apply(null, args);
        }, wait);
    };
  }

  function courseSearch() {
      return {
          searchQuery: '',
          showFilters: false,  // For the mobile filter menu visibility
          submitForm() {
              document.getElementById('course-search-form').submit();
          },
          clearSearchAndRefresh() {
              window.location.href = "{% url 'content:course-list' %}";
          }
      };
  }
</script>
{% endblock content %}
